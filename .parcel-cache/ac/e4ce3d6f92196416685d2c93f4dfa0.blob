{"mappings":"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","sources":["./src/assets/js/formModule.js","./src/assets/js/resultModule.js","./src/assets/js/app.js"],"sourcesContent":["\nexport default formModule = {\n  base_url: null,\n\n  setBaseUrl: (url) => {\n    formModule.base_url = url;\n  },\n\n  // Récupération des options pour générer le formulaire\n  getFormOptionsFromAPI: async () => {\n\n    try {\n      const result = await fetch(`${formModule.base_url}/`, {\n        method: \"GET\",\n      });\n\n      const json = await result.json();\n      \n      formModule.setFormOptions(json);\n\n    } catch (error) {\n      console.error(`Impossible de charger les options depuis l'API `, error);\n    }\n  },\n\n  // Injection des options dans le HTML\n  setFormOptions: (options) => {\n    // console.log(\"setFormOptions\");\n\n    // -- OPTIONS DE REGIONS\n    const locationRegion = document.getElementById(\"locationRegion\");\n\n    for (const region of options.regions) {\n      if (region.id > 5) {\n        const regionOption = document.createElement(\"option\");\n        regionOption.setAttribute(\"value\", region.id);\n        const regionOptionText = document.createTextNode(region.name_region);\n        regionOption.appendChild(regionOptionText);\n        locationRegion.appendChild(regionOption);\n      }\n    }\n\n    // -- OPTIONS DE DEPARTEMENTS\n    const locationDepartment = document.getElementById(\"locationDepartment\");\n\n    for (const department of options.departments) {\n      if (department.id < 500) {\n        const departmentOption = document.createElement(\"option\");\n        departmentOption.setAttribute(\"value\", department.id);\n        const departmentOptionText = document.createTextNode(\n          department.name_dpt\n        );\n        departmentOption.appendChild(departmentOptionText);\n        locationDepartment.appendChild(departmentOption);\n      }\n    }\n  },\n\n  handleSearchForm: async (event) => {\n    event.preventDefault();\n\n    const formData = new FormData(event.target);\n\n    console.log('handleSearchForm');\n\n    let error = false;\n\n    //\n    // VERIFICATION QUE LE FORM EST CORRECTEMENT REMPLI\n    //\n    //\n    // PAR REGION : IL FAUT SELECTIONNER UNE REGION\n    if (\n      formData.get(\"location\") === \"region\" &&\n      (isNaN(parseInt(formData.get(\"locationRegion\"))) || formData.get(\"locationRegion\") === null)\n    ) \n    {\n      const fieldRegion = document\n        .getElementById(\"locationRegion\")\n        .closest(\".radioButtonOption\");\n\n      fieldRegion.classList.add(\"error\");\n      const formBlock = fieldRegion.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldRegion.classList.remove(\"error\");\n      });\n\n      error = true;\n    }\n\n    // PAR DEPARTEMENT : IL FAUT SELECTIONNER UN DEPARTEMENT\n    if (\n      formData.get(\"location\") === \"department\" &&\n      isNaN(parseInt(formData.get(\"locationDepartment\")))\n    ) \n    {\n      const fieldDepartment = document\n        .getElementById(\"locationDepartment\")\n        .closest(\".radioButtonOption\");\n      fieldDepartment.classList.add(\"error\");\n      const formBlock = fieldDepartment.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldDepartment.classList.remove(\"error\");\n      });\n\n      error = true;\n    }\n\n    // AIRE URBAINE : IL FAUT FAIRE UNE SELECTION\n    if (\n      formData.get(\"type\") === \"urbaine\" &&\n      isNaN(parseInt(formData.get(\"uu\")))\n    )\n    {\n      const fieldUU = document\n        .getElementById(\"uu\")\n        .closest(\".radioButtonOption\");\n      fieldUU.classList.add(\"error\");\n      const formBlock = fieldUU.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldUU.classList.remove(\"error\");\n      });\n\n      error = true;\n    }\n\n    // POPULATION : IL FAUT QUE GAUCHE SOIT INFERIEUR A DROITE\n    if (parseInt(formData.get(\"townMin\")) > parseInt(formData.get(\"townMax\"))) \n    {\n      const fieldMin = document\n        .getElementById(\"townMin\")\n        .closest(\".formBlockSelect\");\n      const fieldMax = document\n        .getElementById(\"townMax\")\n        .closest(\".formBlockSelect\");\n      fieldMin.classList.add(\"error\");\n      fieldMax.classList.add(\"error\");\n      const formBlock = fieldMin.closest(\".formBlock\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldMin.classList.remove(\"error\");\n        fieldMax.classList.remove(\"error\");\n      });\n      error = true;\n    }\n\n    // ECOLE : IL FAUT SELECTIONNER AU MOINS UN TYPE D'ECOLE\n    if (\n      formData.get(\"school\") === \"true\" &&\n      formData.get(\"schoolOptions\") === null\n    ) \n    {\n      const fieldSchool = document\n        .getElementById(\"schoolOptions\")\n        .closest(\".radioButtonOption\");\n      fieldSchool.classList.add(\"error\");\n      const formBlock = fieldSchool.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldSchool.classList.remove(\"error\");\n      });\n      error = true;\n    }\n\n    //\n    // SI LE FORM N'EST PAS REMPLI CORRECTEMENT :\n    //\n    if(error===true){\n      document.getElementById('formErrorAlert').textContent = 'Vos critères de recherche sont incomplets, veuillez corriger :)';\n    }\n\n    //\n    // SI LE FORM EST REMPLI CORRECTEMENT :\n    //\n    if (error === false) {\n\n      console.log('else');\n\n      // CACHER LE FORM DE RECHERCHE\n      const form = document.getElementById(\"searchForm\");\n      form.classList.add(\"isInvisible\");\n\n      // AFFICHER LE LOADER\n      const loader = document.getElementById(\"searchInProgress\");\n      loader.classList.remove(\"isInvisible\");\n\n      // ENVOYER LA RECHERCHE AU BACK\n      try {\n        const result = await fetch(`${formModule.base_url}/`, {\n          method: \"POST\",\n          body: formData,\n        });\n\n        if (result.ok) {\n          const json = await result.json();\n          console.log(`On a reçu un résultat !`);\n\n          resultModule.showSearchResults(json);\n        } else {\n          console.error(\"On a eu un pépin sur le serveur\");\n        }\n      } catch (error) {\n        console.error(\n          `Impossible de charger les résultats de la recherche depuis l'API`,\n          error\n        );\n      }\n    }\n  },\n};\n","import app from './app';\n\nexport default resultModule = {\n  base_url: null,\n\n  setBaseUrl: (url) => {\n    resultModule.base_url = url;\n  },\n\n  showSearchResults: (results) => {\n    console.log(\"Search results !\");\n\n    // GENERER LE MENU DES RESULTATS\n    resultModule.handleSearchMenuOptions(results);\n\n    // CACHER LE LOADER\n    const loader = document.getElementById(\"searchInProgress\");\n    loader.classList.add(\"isInvisible\");\n\n    // AFFICHER LA SECTION D'AFFICHAGE DES RESULTATS\n    const searchResults = document.getElementById(\"searchResults\");\n    searchResults.classList.remove(\"isInvisible\");\n\n    // AFFICHER LE NOMBRE DE RESULTATS DISPONIBLES\n    const resultSentence = document.getElementById(\"searchResultsNumber\");\n    if (results.length == 0) {\n      resultSentence.textContent = `Il n'existe pas de ville correspondant à votre recherche`;\n    }\n    if (results.length == 1) {\n      resultSentence.textContent = `Il existe ${results.length} ville correspondant à votre recherche`;\n    }\n    if (results.length > 1) {\n      resultSentence.textContent = `Il existe ${results.length} villes correspondant à votre recherche`;\n    }\n\n    // GENERER 1 FICHE VILLE / RESULTAT \n    for (const result of results) {\n      resultModule.makeTownCardInDOM(result);\n    }\n  },\n\n  makeTownCardInDOM: (data) => {\n    // console.log(data);\n\n    const template = document.getElementById(\"townCardTemplate\");\n    const node = document.importNode(template.content, true);\n\n    // NOM DE VILLE\n    const townName = node.querySelector(\".townCardName\");\n    townName.textContent = data.name_town;\n\n    // NOM DE REGION\n    const townRegion = node.querySelector(\".townCardRegion\");\n    townRegion.textContent = `(${data.region.name_region})`;\n\n    // NOM DE DEPARTEMENT\n    const townDepartment = node.querySelector(\".townCardDepartment\");\n    townDepartment.textContent = data.department.name_dpt;\n\n    // ZONE URBAINE OU ZONE RURALE\n    const townUU = node.querySelector(\".townCardUU\");\n    const uuName = data.urban_unit.name_uu;\n\n    //console.log(\"uuName\");\n    //console.log(uuName);\n\n    if (uuName.includes(\"hors unité urbaine\") == true) {\n      const uuNameUpdated = uuName.replace(\"hors unité urbaine\", \"rurale\");\n      console.log(uuName);\n      townUU.textContent = uuNameUpdated;\n    } else {\n      townUU.textContent = `Commune appartenant à l'aire urbaine de ${uuName}`;\n    }\n\n    // NB HABITANTS\n    const townPopulation = node.querySelector(\".townCardPop\");\n    townPopulation.textContent = `${data.population.population_total} habitants`;\n\n    // ECOLES\n    const townSchool = node.querySelector(\".townCardSchool\");\n    const schoolSection = node.querySelector(\".schoolSection\");\n    const schoolIcon = node.querySelector(\".schoolIcon\");\n\n    const dataKeys = Object.keys(data);\n\n    if (dataKeys.includes(\"school\") == true) {\n      const schools = data.school;\n\n      if (schools.length == 1) {\n        townSchool.textContent = `Il y a ${data.school.length} école correspondant à votre recherche :`;\n      }\n\n      if (schools.length > 1) {\n        townSchool.textContent = `Il y a ${data.school.length} écoles correspondant à votre recherche :`;\n      }\n\n      const schoolList = document.createElement(\"ul\");\n      schoolList.setAttribute(\"class\", \"schoolList\");\n      townSchool.appendChild(schoolList);\n\n      for (const school of schools) {\n        const schoolElement = document.createElement(\"li\");\n        schoolElement.setAttribute(\"class\", \"schoolElement\");\n        schoolElement.textContent = `- ${school.name_place} (${school.secteur})`;\n        schoolList.appendChild(schoolElement);\n      }\n    } else {\n      townSchool.setAttribute(\"hidden\", \"\");\n      schoolSection.setAttribute(\"hidden\", \"\");\n      schoolIcon.setAttribute(\"hidden\", \"\");\n    }\n\n    // AJOUT DE LA CARTE AU DOM\n    document.getElementById(\"searchResultsContainer\").appendChild(node);\n  },\n\n\n  handleSearchMenuOptions : () => {\n\n    // NOUVELLE RECHERCHE : RELOAD DE LA PAGE D'ACCUEIL\n    const newSearch = document.getElementById(\"newSearch\");\n    newSearch.addEventListener(\"click\", app.reloadHomepage);\n\n    // TODO MODIFIER LA RECHERCHE\n\n    // TODO ENVOYER LES RESULTATS DE RECHERCHE PAR MAIL AVEC MAILTO\n\n  }\n};\n","import formModule from './formModule';\nimport resultModule from './resultModule';\n\n\nexport default app = {\n\n  base_url:\"https://mavilleauvertpublicapi.onrender.com\",\n\n  init: async () => {\n    console.log(\"app.init !\");\n\n    formModule.setBaseUrl(app.base_url);\n    resultModule.setBaseUrl(app.base_url);\n    app.addListeners();\n\n    \n    await formModule.getFormOptionsFromAPI();\n\n  },\n\n  addListeners: () => {\n    const searchForm = document.getElementById(\"searchForm\");\n    searchForm.addEventListener(\"submit\", (event)=> {formModule.handleSearchForm(event)});\n    console.log(`L'event listener is in da place !`);\n    console.log(`Coucou toi fellow dev qui jette un oeil dans la console ! Pour voir le code, ça se passe ici : https://github.com/marion-vgv`);\n\n    const aboutLink = document.getElementById(\"aboutLink\");\n    aboutLink.addEventListener(\"click\", app.showAboutModal);\n\n    const closeModalIcon = document.getElementById(\"closeIcon\");\n    closeModalIcon.addEventListener(\"click\", app.hideAboutModal);\n  },\n\n  // handleSearchForm: (event) => {\n  //   formModule.handleSearchForm(event);\n  // },\n\n  reloadHomepage : () => {\n    document.location.reload();\n  },\n\n  showAboutModal : () => {\n    const modal = document.getElementById(\"modal\");\n    modal.classList.remove(\"isInvisible\");\n\n\n  },\n\n  hideAboutModal : () => {\n    const modal = document.getElementById(\"modal\");\n    modal.classList.add(\"isInvisible\");\n  }\n\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", app.init);\n"],"names":["formModule","base_url","setBaseUrl","url","getFormOptionsFromAPI","async","result","fetch","method","json","setFormOptions","error","console","options","locationRegion","document","getElementById","region","regions","id","regionOption","createElement","setAttribute","regionOptionText","createTextNode","name_region","appendChild","locationDepartment","department","departments","departmentOption","departmentOptionText","name_dpt","handleSearchForm","event","preventDefault","formData","FormData","target","log","get","isNaN","parseInt","fieldRegion","closest","classList","add","addEventListener","remove","fieldDepartment","fieldUU","fieldMin","fieldMax","fieldSchool","textContent","body","ok","resultModule","showSearchResults","results","handleSearchMenuOptions","resultSentence","length","makeTownCardInDOM","data","template","node","importNode","content","querySelector","name_town","townUU","uuName","urban_unit","name_uu","includes","uuNameUpdated","replace","population","population_total","townSchool","schoolSection","schoolIcon","Object","keys","schools","school","schoolList","schoolElement","name_place","secteur","_default","reloadHomepage","app","init","addListeners","$e5eea43136c8cd618599be1934fe4f5f$export$default","showAboutModal","hideAboutModal","location","reload"],"version":3,"file":"index.HASH_REF_99d5daca8d3e5e5b8c46c9929d032095.js.map"}