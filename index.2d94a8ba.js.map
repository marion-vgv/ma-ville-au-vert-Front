{"mappings":"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","sources":["./src/assets/js/formModule.js","./src/assets/js/resultModule.js","./src/assets/js/app.js"],"sourcesContent":["\nexport default formModule = {\n  base_url: null,\n\n  setBaseUrl: (url) => {\n    formModule.base_url = url;\n  },\n\n  // Récupération des options pour générer le formulaire\n  getFormOptionsFromAPI: async () => {\n\n    try {\n      const result = await fetch(`${formModule.base_url}/`, {\n        method: \"GET\",\n      });\n\n      const json = await result.json();\n      \n      formModule.setFormOptions(json);\n\n    } catch (error) {\n      console.error(`Impossible de charger les options depuis l'API `, error);\n    }\n  },\n\n  // Injection des options dans le HTML\n  setFormOptions: (options) => {\n    // console.log(\"setFormOptions\");\n\n    // -- OPTIONS DE REGIONS\n    const locationRegion = document.getElementById(\"locationRegion\");\n\n    for (const region of options.regions) {\n      if (region.id > 5) {\n        const regionOption = document.createElement(\"option\");\n        regionOption.setAttribute(\"value\", region.id);\n        const regionOptionText = document.createTextNode(region.name_region);\n        regionOption.appendChild(regionOptionText);\n        locationRegion.appendChild(regionOption);\n      }\n    }\n\n    // -- OPTIONS DE DEPARTEMENTS\n    const locationDepartment = document.getElementById(\"locationDepartment\");\n\n    for (const department of options.departments) {\n      if (department.id < 500) {\n        const departmentOption = document.createElement(\"option\");\n        departmentOption.setAttribute(\"value\", department.id);\n        const departmentOptionText = document.createTextNode(\n          department.name_dpt\n        );\n        departmentOption.appendChild(departmentOptionText);\n        locationDepartment.appendChild(departmentOption);\n      }\n    }\n  },\n\n  handleSearchForm: async (event) => {\n    event.preventDefault();\n\n    const formData = new FormData(event.target);\n\n    //\n    // VERIFICATION QUE LE FORM EST CORRECTEMENT REMPLI\n    //\n    //\n    // PAR REGION : IL FAUT SELECTIONNER UNE REGION\n    if (\n      formData.get(\"location\") === \"region\" &&\n      isNaN(parseInt(formData.get(\"locationRegion\")))\n    ) {\n      const fieldRegion = document\n        .getElementById(\"locationRegion\")\n        .closest(\".radioButtonOption\");\n      fieldRegion.classList.add(\"error\");\n      const formBlock = fieldRegion.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldRegion.classList.remove(\"error\");\n      });\n    }\n\n    // PAR DEPARTEMENT : IL FAUT SELECTIONNER UN DEPARTEMENT\n    if (\n      formData.get(\"location\") === \"department\" &&\n      isNaN(parseInt(formData.get(\"locationDepartment\")))\n    ) {\n      const fieldDepartment = document\n        .getElementById(\"locationDepartment\")\n        .closest(\".radioButtonOption\");\n      fieldDepartment.classList.add(\"error\");\n      const formBlock = fieldDepartment.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldDepartment.classList.remove(\"error\");\n      });\n    }\n\n    // AIRE URBAINE : IL FAUT FAIRE UNE SELECTION\n    if (\n      formData.get(\"type\") === \"urbaine\" &&\n      isNaN(parseInt(formData.get(\"uu\")))\n    ) {\n      const fieldUU = document\n        .getElementById(\"uu\")\n        .closest(\".radioButtonOption\");\n      fieldUU.classList.add(\"error\");\n      const formBlock = fieldUU.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldUU.classList.remove(\"error\");\n      });\n    }\n\n    // POPULATION : IL FAUT QUE GAUCHE SOIT INFERIEUR A DROITE\n    if (parseInt(formData.get(\"townMin\")) > parseInt(formData.get(\"townMax\"))) {\n      const fieldMin = document\n        .getElementById(\"townMin\")\n        .closest(\".formBlockSelect\");\n      const fieldMax = document\n        .getElementById(\"townMax\")\n        .closest(\".formBlockSelect\");\n      fieldMin.classList.add(\"error\");\n      fieldMax.classList.add(\"error\");\n      const formBlock = fieldMin.closest(\".formBlock\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldMin.classList.remove(\"error\");\n        fieldMax.classList.remove(\"error\");\n      });\n    }\n\n    // ECOLE : IL FAUT SELECTIONNER AU MOINS UN TYPE D'ECOLE\n    if (\n      formData.get(\"school\") === \"true\" &&\n      formData.get(\"schoolOptions\") === null\n    ) {\n      const fieldSchool = document\n        .getElementById(\"schoolOptions\")\n        .closest(\".radioButtonOption\");\n      fieldSchool.classList.add(\"error\");\n      const formBlock = fieldSchool.closest(\".formBlockRadio\");\n      formBlock.addEventListener(\"click\", () => {\n        fieldSchool.classList.remove(\"error\");\n      });\n    }\n    //\n    // SI LE FORM EST REMPLI CORRECTEMENT :\n    //\n    else {\n      // CACHER LE FORM DE RECHERCHE\n      const form = document.getElementById(\"searchForm\");\n      form.classList.add(\"isInvisible\");\n\n      // AFFICHER LE LOADER\n      const loader = document.getElementById(\"searchInProgress\");\n      loader.classList.remove(\"isInvisible\");\n\n      // ENVOYER LA RECHERCHE AU BACK\n      try {\n        const result = await fetch(`${formModule.base_url}/`, {\n          method: \"POST\",\n          body: formData,\n        });\n\n        if (result.ok) {\n          const json = await result.json();\n          console.log(`On a reçu un résultat !`);\n\n          resultModule.showSearchResults(json);\n        } else {\n          console.error(\"On a eu un pépin sur le serveur\");\n        }\n      } catch (error) {\n        console.error(\n          `Impossible de charger les résultats de la recherche depuis l'API`,\n          error\n        );\n      }\n    }\n  },\n};\n","import app from './app';\n\nexport default resultModule = {\n  base_url: null,\n\n  setBaseUrl: (url) => {\n    resultModule.base_url = url;\n  },\n\n  showSearchResults: (results) => {\n    console.log(\"Search results !\");\n\n    // GENERER LE MENU DES RESULTATS\n    resultModule.handleSearchMenuOptions(results);\n\n    // CACHER LE LOADER\n    const loader = document.getElementById(\"searchInProgress\");\n    loader.classList.add(\"isInvisible\");\n\n    // AFFICHER LA SECTION D'AFFICHAGE DES RESULTATS\n    const searchResults = document.getElementById(\"searchResults\");\n    searchResults.classList.remove(\"isInvisible\");\n\n    // AFFICHER LE NOMBRE DE RESULTATS DISPONIBLES\n    const resultSentence = document.getElementById(\"searchResultsNumber\");\n    if (results.length == 0) {\n      resultSentence.textContent = `Il n'existe pas de ville correspondant à votre recherche`;\n    }\n    if (results.length == 1) {\n      resultSentence.textContent = `Il existe ${results.length} ville correspondant à votre recherche`;\n    }\n    if (results.length > 1) {\n      resultSentence.textContent = `Il existe ${results.length} villes correspondant à votre recherche`;\n    }\n\n    // GENERER 1 FICHE VILLE / RESULTAT \n    for (const result of results) {\n      resultModule.makeTownCardInDOM(result);\n    }\n  },\n\n  makeTownCardInDOM: (data) => {\n    // console.log(data);\n\n    const template = document.getElementById(\"townCardTemplate\");\n    const node = document.importNode(template.content, true);\n\n    // NOM DE VILLE\n    const townName = node.querySelector(\".townCardName\");\n    townName.textContent = data.name_town;\n\n    // NOM DE REGION\n    const townRegion = node.querySelector(\".townCardRegion\");\n    townRegion.textContent = `(${data.region.name_region})`;\n\n    // NOM DE DEPARTEMENT\n    const townDepartment = node.querySelector(\".townCardDepartment\");\n    townDepartment.textContent = data.department.name_dpt;\n\n    // ZONE URBAINE OU ZONE RURALE\n    const townUU = node.querySelector(\".townCardUU\");\n    const uuName = data.urban_unit.name_uu;\n\n    //console.log(\"uuName\");\n    //console.log(uuName);\n\n    if (uuName.includes(\"hors unité urbaine\") == true) {\n      const uuNameUpdated = uuName.replace(\"hors unité urbaine\", \"rurale\");\n      console.log(uuName);\n      townUU.textContent = uuNameUpdated;\n    } else {\n      townUU.textContent = `Commune appartenant à l'aire urbaine de ${uuName}`;\n    }\n\n    // NB HABITANTS\n    const townPopulation = node.querySelector(\".townCardPop\");\n    townPopulation.textContent = `${data.population.population_total} habitants`;\n\n    // ECOLES\n    const townSchool = node.querySelector(\".townCardSchool\");\n    const schoolSection = node.querySelector(\".schoolSection\");\n    const schoolIcon = node.querySelector(\".schoolIcon\");\n\n    const dataKeys = Object.keys(data);\n\n    if (dataKeys.includes(\"school\") == true) {\n      const schools = data.school;\n\n      if (schools.length == 1) {\n        townSchool.textContent = `Il y a ${data.school.length} école correspondant à votre recherche :`;\n      }\n\n      if (schools.length > 1) {\n        townSchool.textContent = `Il y a ${data.school.length} écoles correspondant à votre recherche :`;\n      }\n\n      const schoolList = document.createElement(\"ul\");\n      schoolList.setAttribute(\"class\", \"schoolList\");\n      townSchool.appendChild(schoolList);\n\n      for (const school of schools) {\n        const schoolElement = document.createElement(\"li\");\n        schoolElement.setAttribute(\"class\", \"schoolElement\");\n        schoolElement.textContent = `- ${school.name_place} (${school.secteur})`;\n        schoolList.appendChild(schoolElement);\n      }\n    } else {\n      townSchool.setAttribute(\"hidden\", \"\");\n      schoolSection.setAttribute(\"hidden\", \"\");\n      schoolIcon.setAttribute(\"hidden\", \"\");\n    }\n\n    // AJOUT DE LA CARTE AU DOM\n    document.getElementById(\"searchResultsContainer\").appendChild(node);\n  },\n\n\n  handleSearchMenuOptions : () => {\n\n    // NOUVELLE RECHERCHE : RELOAD DE LA PAGE D'ACCUEIL\n    const newSearch = document.getElementById(\"newSearch\");\n    newSearch.addEventListener(\"click\", app.reloadHomepage);\n\n    // TODO MODIFIER LA RECHERCHE\n\n    // TODO ENVOYER LES RESULTATS DE RECHERCHE PAR MAIL AVEC MAILTO\n\n  }\n};\n","import formModule from './formModule';\nimport resultModule from './resultModule';\n\n\nexport default app = {\n\n  base_url:\"https://mavilleauvertpublicapi.onrender.com\",\n\n  init: async () => {\n    console.log(\"app.init !\");\n\n    formModule.setBaseUrl(app.base_url);\n    resultModule.setBaseUrl(app.base_url);\n    app.addListeners();\n\n    await formModule.getFormOptionsFromAPI();\n\n  },\n\n  addListeners: () => {\n    const searchForm = document.getElementById(\"searchForm\");\n    searchForm.addEventListener(\"submit\", app.handleSearchForm);\n    console.log(`L'event listener is in da place !`);\n\n    const aboutLink = document.getElementById(\"aboutLink\");\n    aboutLink.addEventListener(\"click\", app.showAboutModal);\n\n    const closeModalIcon = document.getElementById(\"closeIcon\");\n    closeModalIcon.addEventListener(\"click\", app.hideAboutModal);\n  },\n\n  handleSearchForm: (event) => {\n    formModule.handleSearchForm(event);\n  },\n\n  reloadHomepage : () => {\n    document.location.reload();\n  },\n\n  showAboutModal : () => {\n    const modal = document.getElementById(\"modal\");\n    modal.classList.remove(\"isInvisible\");\n\n\n  },\n\n  hideAboutModal : () => {\n    const modal = document.getElementById(\"modal\");\n    modal.classList.add(\"isInvisible\");\n  }\n\n};\n\ndocument.addEventListener(\"DOMContentLoaded\", app.init);\n"],"names":["formModule","base_url","setBaseUrl","url","getFormOptionsFromAPI","async","result","fetch","method","json","setFormOptions","error","console","options","locationRegion","document","getElementById","region","regions","id","regionOption","createElement","setAttribute","regionOptionText","createTextNode","name_region","appendChild","locationDepartment","department","departments","departmentOption","departmentOptionText","name_dpt","handleSearchForm","event","preventDefault","formData","FormData","target","get","isNaN","parseInt","fieldRegion","closest","classList","add","addEventListener","remove","fieldDepartment","fieldUU","fieldMin","fieldMax","fieldSchool","body","ok","log","resultModule","showSearchResults","results","handleSearchMenuOptions","resultSentence","length","textContent","makeTownCardInDOM","data","template","node","importNode","content","querySelector","name_town","townUU","uuName","urban_unit","name_uu","includes","uuNameUpdated","replace","population","population_total","townSchool","schoolSection","schoolIcon","Object","keys","schools","school","schoolList","schoolElement","name_place","secteur","_default","reloadHomepage","app","init","addListeners","$e5eea43136c8cd618599be1934fe4f5f$export$default","showAboutModal","hideAboutModal","location","reload"],"version":3,"file":"index.2d94a8ba.js.map"}